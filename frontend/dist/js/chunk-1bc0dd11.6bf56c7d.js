(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1bc0dd11"],{"1dbc":function(t,s,e){"use strict";e("d283")},"235a":function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"agent-list"},[s("h3",{staticClass:"mb-4"},[t._v("Agent管理")]),s("div",{staticClass:"d-flex justify-content-end mb-3"},[s("b-button",{staticClass:"mr-2",attrs:{variant:"outline-secondary",disabled:t.loading},on:{click:t.handleCheckAgentsStatus}},[s("b-icon",{staticClass:"mr-1",attrs:{icon:"arrow-repeat"}}),t._v(" 检查Agent状态 ")],1),s("b-button",{attrs:{variant:"outline-primary",disabled:t.loading},on:{click:t.refreshAgents}},[s("b-icon",{staticClass:"mr-1",attrs:{icon:"arrow-clockwise"}}),t._v(" 刷新列表 ")],1)],1),t.loading?s("div",{staticClass:"text-center py-5"},[s("b-spinner",{attrs:{variant:"primary",label:"加载中..."}}),s("p",{staticClass:"mt-2"},[t._v("加载Agent信息...")])],1):t._e(),t.error?s("b-alert",{attrs:{show:"",variant:"danger",dismissible:""}},[t._v(" "+t._s(t.error)+" ")]):t._e(),t.loading||0!==t.mainAgents.length?s("div",{staticClass:"agent-tree"},t._l(t.mainAgents,(function(e){return s("div",{key:e.id,staticClass:"mb-4"},[s("b-card",{class:["main-agent-card",{offline:"offline"===e.status}],attrs:{"no-body":""}},[s("b-card-header",{staticClass:"d-flex justify-content-between align-items-center"},[s("div",[s("b-badge",{staticClass:"mr-2",attrs:{variant:"primary"}},[t._v("主")]),s("strong",[t._v(t._s(e.name))]),s("span",{staticClass:"text-muted ml-2"},[t._v("(ID: "+t._s(e.id)+")")])],1),s("div",[s("b-badge",{staticClass:"mr-2",attrs:{variant:t.getStatusVariant(e.status)}},[t._v(" "+t._s(t.getStatusText(e.status))+" ")]),s("small",{staticClass:"text-muted"},[s("b-icon",{attrs:{icon:"clock"}}),t._v(" 运行时长: "+t._s(t.formatDuration(e.running_time))+" ")],1),"offline"!==e.status&&"canceled"!==e.status?s("b-button",{staticClass:"ml-2",attrs:{variant:"outline-danger",size:"sm"},on:{click:function(s){return t.handleCancelAgent(e.id)}}},[t._v(" 取消 ")]):t._e()],1)]),s("b-card-body",[s("div",{staticClass:"resource-section mb-3"},[s("h6",{staticClass:"mb-2"},[t._v("CPU资源")]),s("div",{staticClass:"d-flex align-items-center"},[s("strong",{staticClass:"mr-2"},[t._v("使用率:")]),s("b-progress",{staticClass:"flex-grow-1",attrs:{value:e.cpu_usage||0,max:100,variant:t.getResourceVariant(e.cpu_usage||0),"show-progress":"",height:"1.5rem"}},[s("span",[t._v(t._s(e.cpu_usage||0)+"%")])])],1),s("div",{staticClass:"mt-2"},[s("strong",[t._v("核心数:")]),t._v(" "+t._s(e.cpu_cores||0)+" 核 (可用: "+t._s(e.available_cpu_cores||0)+" 核) ")])]),e.gpu_ids&&e.gpu_ids.length>0?s("div",{staticClass:"resource-section"},[s("h6",{staticClass:"mb-2"},[t._v("GPU资源")]),t._l(e.gpu_usage||[],(function(a,n){return s("div",{key:n,staticClass:"mb-2"},[s("strong",[t._v("GPU "+t._s(e.gpu_ids[n]||n)+":")]),s("div",{staticClass:"d-flex mt-1"},[s("div",{staticClass:"mr-3 text-nowrap"},[s("small",[t._v("使用率:")])]),s("b-progress",{staticClass:"flex-grow-1 mr-3",attrs:{value:a.usage||0,max:100,variant:t.getResourceVariant(a.usage||0),"show-progress":""}},[s("span",[t._v(t._s(a.usage||0)+"%")])])],1),s("div",{staticClass:"d-flex mt-1"},[s("div",{staticClass:"mr-3 text-nowrap"},[s("small",[t._v("显存:")])]),s("b-progress",{staticClass:"flex-grow-1 mr-3",attrs:{value:a.memory_used||0,max:a.memory_total||1,variant:"success","show-progress":""}},[s("span",[t._v(t._s(a.memory_used||0)+" / "+t._s(a.memory_total||0)+" MB")])])],1)])})),e.gpu_usage&&0!==e.gpu_usage.length?t._e():s("div",{staticClass:"text-muted"},[t._v(" 无GPU使用数据 ")])],2):t._e()])],1),s("div",{staticClass:"sub-agents ml-5 mt-2"},[t._l(t.getSubAgentsByMainId(e.id),(function(e){return s("div",{key:e.id,staticClass:"mb-2"},[s("b-card",{class:["sub-agent-card",{offline:"offline"===e.status}],attrs:{"no-body":""}},[s("b-card-header",{staticClass:"d-flex justify-content-between align-items-center py-2"},[s("div",[s("b-badge",{staticClass:"mr-2",attrs:{variant:"info"}},[t._v("子")]),s("strong",[t._v(t._s(e.name))]),s("span",{staticClass:"text-muted ml-2"},[t._v("(ID: "+t._s(e.id)+")")])],1),s("div",[s("b-badge",{staticClass:"mr-2",attrs:{variant:t.getStatusVariant(e.status)}},[t._v(" "+t._s(t.getStatusText(e.status))+" ")]),e.task_id?s("small",{staticClass:"text-muted mr-2"},[s("b-icon",{attrs:{icon:"card-list"}}),t._v(" 任务ID: "),s("b-link",{attrs:{to:"/tasks/"+e.task_id}},[t._v(t._s(e.task_id))])],1):t._e(),s("small",{staticClass:"text-muted"},[s("b-icon",{attrs:{icon:"clock"}}),t._v(" 运行时长: "+t._s(t.formatDuration(e.running_time))+" ")],1),"offline"!==e.status&&"canceled"!==e.status?s("b-button",{staticClass:"ml-2",attrs:{variant:"outline-danger",size:"sm"},on:{click:function(s){return t.handleCancelAgent(e.id)}}},[t._v(" 取消 ")]):t._e()],1)]),s("b-card-body",{staticClass:"py-2"},[e.gpu_ids&&e.gpu_ids.length>0?s("div",t._l(e.gpu_usage||[],(function(a,n){return s("div",{key:n,staticClass:"mb-1"},[s("div",{staticClass:"d-flex align-items-center"},[s("small",{staticClass:"text-nowrap mr-2"},[t._v("GPU "+t._s(e.gpu_ids[n]||n)+":")]),s("b-progress",{staticClass:"flex-grow-1",attrs:{value:a.usage||0,max:100,variant:t.getResourceVariant(a.usage||0),height:"0.5rem"}}),s("small",{staticClass:"ml-2"},[t._v(t._s(a.usage||0)+"%")])],1)])})),0):t._e(),s("div",{staticClass:"d-flex align-items-center mt-1"},[s("small",{staticClass:"text-nowrap mr-2"},[t._v("CPU使用率:")]),s("b-progress",{staticClass:"flex-grow-1",attrs:{value:e.cpu_usage||0,max:100,variant:t.getResourceVariant(e.cpu_usage||0),height:"0.5rem"}}),s("small",{staticClass:"ml-2"},[t._v(t._s(e.cpu_usage||0)+"%")])],1)])],1)],1)})),0===t.getSubAgentsByMainId(e.id).length?s("div",{staticClass:"text-muted ml-2 mt-2"},[s("small",[t._v("暂无子Agent")])]):t._e()],2)],1)})),0):s("b-alert",{attrs:{show:"",variant:"info"}},[t._v(" 暂无Agent信息。您可以创建一个主Agent来开始任务调度系统。 "),s("div",{staticClass:"mt-2"},[s("b-button",{attrs:{variant:"primary",size:"sm"},on:{click:t.showCreateAgentModal}},[s("b-icon",{attrs:{icon:"plus"}}),t._v(" 创建主Agent ")],1)],1)]),s("b-modal",{attrs:{id:"create-agent-modal",title:"创建主Agent","ok-title":"创建","cancel-title":"取消","ok-disabled":!t.newAgentName||!t.newAgentCpuCores},on:{ok:t.handleCreateMainAgent}},[s("b-form-group",{attrs:{label:"Agent名称","label-for":"agent-name"}},[s("b-form-input",{attrs:{id:"agent-name",required:"",placeholder:"请输入Agent名称"},model:{value:t.newAgentName,callback:function(s){t.newAgentName=s},expression:"newAgentName"}})],1),s("b-form-group",{attrs:{label:"CPU核心数","label-for":"cpu-cores"}},[s("b-form-input",{attrs:{id:"cpu-cores",type:"number",min:"1",required:"",placeholder:"分配的CPU核心数"},model:{value:t.newAgentCpuCores,callback:function(s){t.newAgentCpuCores=t._n(s)},expression:"newAgentCpuCores"}})],1),s("b-form-group",{attrs:{label:"GPU ID列表 (可选)","label-for":"gpu-ids",description:"多个GPU ID使用逗号分隔"}},[s("b-form-input",{attrs:{id:"gpu-ids",placeholder:"例如: 0,1,2"},model:{value:t.newAgentGpuIds,callback:function(s){t.newAgentGpuIds=s},expression:"newAgentGpuIds"}})],1)],1)],1)},n=[],i=e("2f62"),r=e("c1df"),l=e.n(r),c={name:"AgentList",data(){return{newAgentName:"",newAgentCpuCores:1,newAgentGpuIds:"",pollingEnabled:!0}},computed:{...Object(i["d"])("agents",["loading","error"]),...Object(i["c"])("agents",["mainAgents","subAgents"]),getSubAgentsByMainId(){return t=>this.subAgents.filter(s=>s.main_agent_id===t)}},methods:{...Object(i["b"])("agents",["fetchAgents","createMainAgent","cancelAgent","checkAgentsStatus"]),async refreshAgents(){try{await this.fetchAgents()}catch(t){this.$bvToast.toast("获取Agent列表失败",{title:"错误",variant:"danger",solid:!0})}},async handleCreateMainAgent(){if(!this.newAgentName||!this.newAgentCpuCores)return;const t=this.newAgentGpuIds?this.newAgentGpuIds.split(",").map(t=>t.trim()):[];try{await this.createMainAgent({name:this.newAgentName,cpu_cores:this.newAgentCpuCores,gpu_ids:t}),this.$bvToast.toast("主Agent创建成功",{title:"成功",variant:"success",solid:!0}),this.newAgentName="",this.newAgentCpuCores=1,this.newAgentGpuIds="",this.$bvModal.hide("create-agent-modal")}catch(s){this.$bvToast.toast("创建主Agent失败",{title:"错误",variant:"danger",solid:!0})}},async handleCancelAgent(t){try{await this.$bvModal.msgBoxConfirm("确定要取消此Agent吗？这将停止其所有任务。",{title:"确认取消",okVariant:"danger",okTitle:"确认",cancelTitle:"取消"}),await this.cancelAgent(t),this.$bvToast.toast("Agent已取消",{title:"成功",variant:"success",solid:!0})}catch(s){if(!1===s)return;this.$bvToast.toast("取消Agent失败",{title:"错误",variant:"danger",solid:!0})}},async handleCheckAgentsStatus(){try{await this.checkAgentsStatus(),this.$bvToast.toast("Agent状态已更新",{title:"成功",variant:"success",solid:!0})}catch(t){this.$bvToast.toast("检查Agent状态失败",{title:"错误",variant:"danger",solid:!0})}},showCreateAgentModal(){this.$bvModal.show("create-agent-modal")},getStatusText(t){const s={online:"在线",offline:"离线",busy:"忙碌",idle:"空闲",starting:"启动中",canceled:"已取消"};return s[t]||t},getStatusVariant(t){const s={online:"success",offline:"secondary",busy:"warning",idle:"info",starting:"primary",canceled:"danger"};return s[t]||"secondary"},getResourceVariant(t){return t>=90?"danger":t>=70?"warning":"success"},formatDuration(t){if(!t)return"0秒";const s=l.a.duration(t,"seconds"),e=s.days(),a=s.hours(),n=s.minutes(),i=s.seconds();let r="";return e>0&&(r+=e+"天 "),a>0&&(r+=a+"小时 "),n>0&&(r+=n+"分钟 "),i>0&&0===e&&0===a&&(r+=i+"秒"),r.trim()}},created(){this.refreshAgents(),this.pollingTimeout=setTimeout(()=>{this.refreshAgents()},5e3)},beforeDestroy(){this.pollingTimeout&&clearTimeout(this.pollingTimeout),this.pollingEnabled=!1}},o=c,g=(e("1dbc"),e("2877")),u=Object(g["a"])(o,a,n,!1,null,"6c8a05dc",null);s["default"]=u.exports},d283:function(t,s,e){}}]);
//# sourceMappingURL=chunk-1bc0dd11.6bf56c7d.js.map