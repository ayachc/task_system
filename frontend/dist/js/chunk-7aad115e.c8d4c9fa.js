(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7aad115e"],{a4a0:function(t,e,a){"use strict";a("e936")},c68e:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"task-new"},[e("b-form",{staticClass:"mt-3",on:{submit:function(e){return e.preventDefault(),t.submitTask.apply(null,arguments)}}},[e("div",{staticClass:"card"},[e("div",{staticClass:"card-header"},[e("h5",{staticClass:"mb-0"},[t._v("基本信息")])]),e("div",{staticClass:"card-body"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6"},[e("b-form-group",{attrs:{label:"任务名称","label-for":"task-name",state:t.nameState,"invalid-feedback":t.nameInvalidFeedback}},[e("b-form-input",{attrs:{id:"task-name",state:t.nameState,required:"",placeholder:"请输入任务名称"},model:{value:t.task.name,callback:function(e){t.$set(t.task,"name",e)},expression:"task.name"}})],1)],1),e("div",{staticClass:"col-md-6"},[e("b-form-group",{attrs:{label:"模板类型","label-for":"template-type",state:t.templateTypeState,"invalid-feedback":t.templateTypeInvalidFeedback}},[e("b-form-select",{attrs:{id:"template-type",options:t.templateOptions,state:t.templateTypeState,required:""},on:{change:t.handleTemplateChange},model:{value:t.task.template_type,callback:function(e){t.$set(t.task,"template_type",e)},expression:"task.template_type"}})],1)],1),e("div",{staticClass:"col-md-6"},[e("b-form-group",{attrs:{label:"优先级","label-for":"priority"}},[e("div",{staticClass:"d-flex align-items-center"},[e("b-form-input",{staticClass:"mr-3",attrs:{id:"priority",type:"range",min:"1",max:"5",step:"1"},model:{value:t.task.priority,callback:function(e){t.$set(t.task,"priority",e)},expression:"task.priority"}}),e("span",{staticClass:"priority-label"},[t._v(t._s(t.getPriorityText(t.task.priority)))])],1)])],1),e("div",{staticClass:"col-md-6"},[e("b-form-group",{attrs:{label:"依赖任务 (可选)","label-for":"depends-on",description:"多个任务ID用逗号分隔",state:t.dependsOnState,"invalid-feedback":t.dependsOnInvalidFeedback}},[e("b-form-input",{attrs:{id:"depends-on",state:t.dependsOnState,placeholder:"例如: 1,2,3"},model:{value:t.task.depends_on,callback:function(e){t.$set(t.task,"depends_on",e)},expression:"task.depends_on"}})],1)],1)])])]),e("div",{staticClass:"card mt-3"},[e("div",{staticClass:"card-header"},[e("h5",{staticClass:"mb-0"},[t._v("资源配置")])]),e("div",{staticClass:"card-body"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-4"},[e("b-form-group",{attrs:{label:"CPU核心数","label-for":"cpu-cores",state:t.cpuCoresState,"invalid-feedback":t.cpuCoresInvalidFeedback}},[e("b-form-input",{attrs:{id:"cpu-cores",type:"number",min:"1",state:t.cpuCoresState,placeholder:"默认: 1"},model:{value:t.task.cpu_cores,callback:function(e){t.$set(t.task,"cpu_cores",t._n(e))},expression:"task.cpu_cores"}})],1)],1),e("div",{staticClass:"col-md-4"},[e("b-form-group",{attrs:{label:"GPU数量","label-for":"gpu-count",state:t.gpuCountState,"invalid-feedback":t.gpuCountInvalidFeedback}},[e("b-form-input",{attrs:{id:"gpu-count",type:"number",min:"0",state:t.gpuCountState,placeholder:"默认: 0"},model:{value:t.task.gpu_count,callback:function(e){t.$set(t.task,"gpu_count",t._n(e))},expression:"task.gpu_count"}})],1)],1),e("div",{staticClass:"col-md-4"},[e("b-form-group",{attrs:{label:"GPU显存要求 (每卡GB)","label-for":"gpu-memory",state:t.gpuMemoryState}},[e("b-form-select",{attrs:{id:"gpu-memory",options:t.gpuMemoryOptions,state:t.gpuMemoryState},model:{value:t.task.gpu_memory,callback:function(e){t.$set(t.task,"gpu_memory",t._n(e))},expression:"task.gpu_memory"}})],1)],1)])])]),e("div",{staticClass:"card mt-3"},[e("div",{staticClass:"card-header"},[e("h5",{staticClass:"mb-0"},[t._v("脚本内容")])]),e("div",{staticClass:"card-body"},[e("b-form-group",{attrs:{"label-for":"script-content",state:t.scriptContentState,"invalid-feedback":t.scriptContentInvalidFeedback}},[e("b-form-textarea",{staticClass:"code-textarea",attrs:{id:"script-content",rows:"12",state:t.scriptContentState,required:"",placeholder:"请输入脚本内容","no-resize":""},model:{value:t.task.script_content,callback:function(e){t.$set(t.task,"script_content",e)},expression:"task.script_content"}})],1)],1)]),t.error?e("b-alert",{staticClass:"mt-3",attrs:{variant:"danger",dismissible:"",show:""},on:{dismissed:t.clearError}},[t._v(" "+t._s(t.error)+" ")]):t._e(),e("div",{staticClass:"mt-4 d-flex justify-content-between"},[e("b-button",{attrs:{variant:"secondary"},on:{click:function(e){return t.$router.push("/tasks")}}},[t._v("取消")]),e("b-button",{attrs:{type:"submit",variant:"primary",disabled:t.loading}},[t.loading?e("b-spinner",{staticClass:"mr-1",attrs:{small:""}}):t._e(),t._v(" 创建任务 ")],1)],1)],1)],1)},r=[],n=a("2f62"),i={name:"TaskNew",data(){return{task:{name:"",template_type:"",script_content:"",priority:3,depends_on:"",cpu_cores:1,gpu_count:0,gpu_memory:0},validated:!1,gpuMemoryOptions:[{value:0,text:"不使用GPU"},{value:8,text:"8 GB"},{value:12,text:"12 GB"},{value:16,text:"16 GB"},{value:24,text:"24 GB"},{value:32,text:"32 GB"},{value:48,text:"48 GB"},{value:80,text:"80 GB"}]}},computed:{...Object(n["d"])({loading:t=>t.loading,error:t=>t.error}),...Object(n["c"])("templates",["allTemplates"]),templateOptions(){const t=[{value:"",text:"请选择模板类型"},{value:"custom",text:"自定义脚本"}];if(this.allTemplates&&this.allTemplates.length>0){const e=[...new Set(this.allTemplates.map(t=>t.template_type))];e.forEach(e=>{e&&t.push({value:e,text:e})})}return t},nameState(){return this.validated?this.task.name.trim().length>0:null},templateTypeState(){return this.validated?this.task.template_type.trim().length>0:null},scriptContentState(){return this.validated?this.task.script_content.trim().length>0:null},cpuCoresState(){return this.validated?this.task.cpu_cores>0:null},gpuCountState(){return this.validated?this.task.gpu_count>=0:null},gpuMemoryState(){return!!this.validated||null},dependsOnState(){if(!this.validated||!this.task.depends_on)return null;const t=/^(\d+)(,\d+)*$/;return t.test(this.task.depends_on)},nameInvalidFeedback(){return"请输入任务名称"},templateTypeInvalidFeedback(){return"请选择模板类型"},scriptContentInvalidFeedback(){return"请输入脚本内容"},cpuCoresInvalidFeedback(){return"CPU核心数必须大于0"},gpuCountInvalidFeedback(){return"GPU数量不能为负数"},dependsOnInvalidFeedback(){return"请输入有效的任务ID，多个ID用逗号分隔"}},methods:{...Object(n["b"])("tasks",["createTask"]),...Object(n["b"])("templates",["fetchTemplates"]),...Object(n["b"])(["clearError"]),getPriorityText(t){const e={1:"最高",2:"高",3:"中",4:"低",5:"最低"};return e[t]||t},handleTemplateChange(){if(this.task.template_type&&"custom"!==this.task.template_type){const t=this.allTemplates.find(t=>t.template_type===this.task.template_type);t&&(this.task.script_content=t.script_content||"")}else"custom"===this.task.template_type&&(this.task.script_content="")},parseDependsOn(){return this.task.depends_on?this.task.depends_on.split(",").map(t=>parseInt(t.trim())).filter(t=>!isNaN(t)):[]},async submitTask(){if(this.validated=!0,!this.nameState||!this.templateTypeState||!this.scriptContentState||!this.cpuCoresState||!this.gpuCountState||this.task.depends_on&&!this.dependsOnState)return void this.$bvToast.toast("请修正表单中的错误",{title:"验证失败",variant:"danger",solid:!0});const t={name:this.task.name,template_type:this.task.template_type,script_content:this.task.script_content,priority:parseInt(this.task.priority),cpu_cores:parseInt(this.task.cpu_cores),gpu_count:parseInt(this.task.gpu_count),gpu_memory:parseInt(this.task.gpu_memory),depends_on:this.parseDependsOn()};try{const e=await this.createTask(t);this.$bvToast.toast("任务创建成功",{title:"成功",variant:"success",solid:!0}),this.$router.push("/tasks/"+e.id)}catch(e){}}},async created(){try{await this.fetchTemplates()}catch(t){console.error("获取模板数据失败:",t)}}},l=i,o=(a("a4a0"),a("2877")),c=Object(o["a"])(l,s,r,!1,null,"238a237d",null);e["default"]=c.exports},e936:function(t,e,a){}}]);
//# sourceMappingURL=chunk-7aad115e.c8d4c9fa.js.map