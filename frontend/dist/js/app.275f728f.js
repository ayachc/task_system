(function(t){function e(e){for(var s,n,c=e[0],i=e[1],l=e[2],u=0,p=[];u<c.length;u++)n=c[u],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&p.push(r[n][0]),r[n]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);m&&m(e);while(p.length)p.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],s=!0,n=1;n<a.length;n++){var c=a[n];0!==r[c]&&(s=!1)}s&&(o.splice(e--,1),t=i(i.s=a[0]))}return t}var s={},n={app:0},r={app:0},o=[];function c(t){return i.p+"js/"+({}[t]||t)+"."+{"chunk-4c0ee788":"eced3fab","chunk-14b4a015":"13189099","chunk-44a4bfb0":"6be92c09","chunk-d8154e58":"f67d2c62","chunk-6597f707":"e2de30dc","chunk-7aad115e":"c8d4c9fa"}[t]+".js"}function i(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.e=function(t){var e=[],a={"chunk-14b4a015":1,"chunk-44a4bfb0":1,"chunk-d8154e58":1,"chunk-6597f707":1,"chunk-7aad115e":1};n[t]?e.push(n[t]):0!==n[t]&&a[t]&&e.push(n[t]=new Promise((function(e,a){for(var s="css/"+({}[t]||t)+"."+{"chunk-4c0ee788":"31d6cfe0","chunk-14b4a015":"2f0ccc53","chunk-44a4bfb0":"490129d5","chunk-d8154e58":"87acce66","chunk-6597f707":"ec52dcfc","chunk-7aad115e":"400a9d45"}[t]+".css",r=i.p+s,o=document.getElementsByTagName("link"),c=0;c<o.length;c++){var l=o[c],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===s||u===r))return e()}var p=document.getElementsByTagName("style");for(c=0;c<p.length;c++){l=p[c],u=l.getAttribute("data-href");if(u===s||u===r)return e()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=e,m.onerror=function(e){var s=e&&e.target&&e.target.src||r,o=new Error("Loading CSS chunk "+t+" failed.\n("+s+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=s,delete n[t],m.parentNode.removeChild(m),a(o)},m.href=r;var g=document.getElementsByTagName("head")[0];g.appendChild(m)})).then((function(){n[t]=0})));var s=r[t];if(0!==s)if(s)e.push(s[2]);else{var o=new Promise((function(e,a){s=r[t]=[e,a]}));e.push(s[2]=o);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,i.nc&&u.setAttribute("nonce",i.nc),u.src=c(t);var p=new Error;l=function(e){u.onerror=u.onload=null,clearTimeout(m);var a=r[t];if(0!==a){if(a){var s=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src;p.message="Loading chunk "+t+" failed.\n("+s+": "+n+")",p.name="ChunkLoadError",p.type=s,p.request=n,a[1](p)}r[t]=void 0}};var m=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(e)},i.m=t,i.c=s,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(a,s,function(e){return t[e]}.bind(null,s));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=e,l=l.slice();for(var p=0;p<l.length;p++)e(l[p]);var m=u;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);var s=a("2b0e"),n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row"},[e("nav",{staticClass:"col-md-3 col-lg-2 d-md-block bg-light sidebar",attrs:{id:"sidebar"}},[e("div",{staticClass:"sidebar-sticky pt-3"},[t._m(0),e("ul",{staticClass:"nav flex-column"},[e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/tasks","active-class":"active"}},[e("i",{staticClass:"bi bi-list-task mr-2"}),t._v(" 任务管理 ")])],1),e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/agents","active-class":"active"}},[e("i",{staticClass:"bi bi-pc-display mr-2"}),t._v(" Agent管理 ")])],1),e("li",{staticClass:"nav-item"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/templates","active-class":"active"}},[e("i",{staticClass:"bi bi-file-earmark-code mr-2"}),t._v(" 脚本模板 ")])],1)]),t._m(1)])]),e("main",{staticClass:"col-md-9 ml-sm-auto col-lg-10 px-md-4",attrs:{role:"main"}},[e("div",{staticClass:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},[e("h1",{staticClass:"h2"},[t._v(t._s(t.currentPageTitle))]),e("div",{staticClass:"btn-toolbar mb-2 mb-md-0"},["/tasks"===t.$route.path?e("div",[e("router-link",{staticClass:"btn btn-sm btn-primary",attrs:{to:"/tasks/new"}},[e("i",{staticClass:"bi bi-plus"}),t._v(" 新建任务 ")])],1):t._e(),"/templates"===t.$route.path?e("div",[e("b-button",{staticClass:"btn btn-sm btn-primary",on:{click:function(e){return t.$root.$emit("show-create-template-modal")}}},[e("i",{staticClass:"bi bi-plus"}),t._v(" 新建模板 ")])],1):t._e()])]),e("router-view")],1)])])])},r=[function(){var t=this,e=t._self._c;return e("h5",{staticClass:"sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"},[e("span",[t._v("脚本执行任务管理系统")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"mt-5 px-3 text-muted small"},[e("div",[t._v("版本: 0.1.0")]),e("div",{staticClass:"mt-2"},[t._v("2025 脚本执行任务管理系统")])])}],o={name:"App",computed:{currentPageTitle(){const t=this.$route.path;return t.startsWith("/tasks")?"/tasks/new"===t?"新建任务":"任务管理":t.startsWith("/agents")?"Agent管理":t.startsWith("/templates")?"/templates/new"===t?"新建模板":"脚本模板":"首页"}}},c=o,i=(a("b140"),a("2877")),l=Object(i["a"])(c,n,r,!1,null,null,null),u=l.exports,p=a("8c4f");const m=()=>Promise.all([a.e("chunk-4c0ee788"),a.e("chunk-d8154e58")]).then(a.bind(null,"f0b3")),g=()=>a.e("chunk-7aad115e").then(a.bind(null,"c68e")),d=()=>Promise.all([a.e("chunk-4c0ee788"),a.e("chunk-44a4bfb0")]).then(a.bind(null,"b480")),T=()=>a.e("chunk-6597f707").then(a.bind(null,"235a")),E=()=>Promise.all([a.e("chunk-4c0ee788"),a.e("chunk-14b4a015")]).then(a.bind(null,"acd7"));s["default"].use(p["a"]);const f=[{path:"/",redirect:"/tasks"},{path:"/tasks",name:"TaskList",component:m},{path:"/tasks/new",name:"TaskNew",component:g},{path:"/tasks/:id",name:"TaskDetail",component:d,props:!0},{path:"/agents",name:"AgentList",component:T},{path:"/templates",name:"TemplateList",component:E},{path:"*",redirect:"/tasks"}],_=new p["a"]({mode:"history",base:"/",routes:f,linkActiveClass:"active"});var h=_,A=a("2f62"),S=a("7424");const k={tasks:[],task:null,pagination:{page:1,perPage:10,total:0,pages:0},filters:{status:"",name:"",template_type:""},taskLog:""},b={taskList:t=>t.tasks,taskDetail:t=>t.task,pagination:t=>t.pagination,filters:t=>t.filters,taskLog:t=>t.taskLog},y={SET_TASKS(t,{tasks:e,total:a,page:s,per_page:n,pages:r}){t.tasks=e,t.pagination.total=a,t.pagination.page=s,t.pagination.perPage=n,t.pagination.pages=r},SET_TASK(t,e){t.task=e},SET_PAGE(t,e){t.pagination.page=e},SET_FILTERS(t,e){t.filters={...t.filters,...e}},UPDATE_TASK_STATUS(t,{taskId:e,newStatus:a}){const s=t.tasks.findIndex(t=>t.id===e);-1!==s&&(t.tasks[s].status=a),t.task&&t.task.id===e&&(t.task.status=a)},SET_TASK_LOG(t,e){t.taskLog=e}},R={async fetchTasks({commit:t,state:e}){try{t("SET_LOADING",!0,{root:!0});const{page:a,perPage:s}=e.pagination,n=e.filters,r={page:a,per_page:s};n.status&&(r.status=n.status),n.name&&(r.name=n.name),n.template_type&&(r.template_type=n.template_type);const o=await S["b"].getTasks(r);return t("SET_TASKS",{tasks:o.tasks,total:o.total,page:o.page,per_page:o.per_page,pages:o.pages}),o}catch(a){throw console.error("获取任务列表失败:",a),t("SET_ERROR",a.message||"获取任务列表失败，请稍后重试",{root:!0}),a}finally{t("SET_LOADING",!1,{root:!0})}},async fetchTask({commit:t},e){try{t("SET_LOADING",!0,{root:!0});const a=await S["b"].getTask(e);return t("SET_TASK",a),a}catch(a){throw console.error(`获取任务${e}详情失败:`,a),t("SET_ERROR",a.message||"获取任务详情失败，请稍后重试",{root:!0}),a}finally{t("SET_LOADING",!1,{root:!0})}},async createTask({commit:t},e){try{t("SET_LOADING",!0,{root:!0});const a=await S["b"].createTask(e);return a}catch(a){throw console.error("创建任务失败:",a),t("SET_ERROR",a.message||"创建任务失败，请检查输入并重试",{root:!0}),a}finally{t("SET_LOADING",!1,{root:!0})}},async cancelTask({commit:t},e){try{return t("SET_LOADING",!0,{root:!0}),await S["b"].cancelTask(e),t("UPDATE_TASK_STATUS",{taskId:e,newStatus:"canceled"}),!0}catch(a){throw console.error(`取消任务${e}失败:`,a),t("SET_ERROR",a.message||"取消任务失败，请稍后重试",{root:!0}),a}finally{t("SET_LOADING",!1,{root:!0})}},async fetchTaskLog({commit:t},{taskId:e,startLine:a,maxLines:s}){try{const n={};void 0!==a&&(n.start_line=a),void 0!==s&&(n.max_lines=s);const r=await S["b"].getTaskLog(e,n);return t("SET_TASK_LOG",r.content||""),r}catch(n){throw console.error(`获取任务${e}日志失败:`,n),n}},setPage({commit:t,dispatch:e},a){return t("SET_PAGE",a),e("fetchTasks")},setFilters({commit:t,dispatch:e},a){return t("SET_FILTERS",a),t("SET_PAGE",1),e("fetchTasks")}};var v={namespaced:!0,state:k,getters:b,mutations:y,actions:R};const O={agents:[],agentTypes:["main","sub"],loading:!1,error:null},L={allAgents:t=>t.agents,mainAgents:t=>t.agents.filter(t=>"main"===t.type),subAgents:t=>t.agents.filter(t=>"sub"===t.type),subAgentsByMainId:t=>e=>t.agents.filter(t=>"sub"===t.type&&t.main_agent_id===e),agentResourceUsage:t=>e=>{const a=t.agents.find(t=>t.id===e);return a?{cpuUsage:a.cpu_usage||0,memoryUsage:a.memory_usage||0,gpuInfo:a.gpu_info||[]}:null},getAgentById:t=>e=>t.agents.find(t=>t.id===e)},w={SET_AGENTS(t,e){t.agents=e},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e},UPDATE_AGENT_STATUS(t,{agentId:e,status:a,resourceData:s}){const n=t.agents.findIndex(t=>t.id===e);if(-1!==n){const e={...t.agents[n]};a&&(e.status=a),s&&(e.cpu_usage=s.cpu_usage||e.cpu_usage,e.memory_usage=s.memory_usage||e.memory_usage,e.gpu_info=s.gpu_info||e.gpu_info),t.agents.splice(n,1,e)}},ADD_AGENT(t,e){t.agents.push(e)},REMOVE_AGENT(t,e){const a=t.agents.findIndex(t=>t.id===e);-1!==a&&t.agents.splice(a,1)}},D={async fetchAgents({commit:t},e={}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await S["a"].getAgents(e);return t("SET_AGENTS",a),a}catch(a){throw t("SET_ERROR",a.message),console.error("获取Agent列表失败:",a),a}finally{t("SET_LOADING",!1)}},async fetchAgent({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await S["a"].getAgent(e);return t("UPDATE_AGENT_STATUS",{agentId:a.id,status:a.status,resourceData:{cpu_usage:a.cpu_usage,memory_usage:a.memory_usage,gpu_info:a.gpu_info}}),a}catch(a){throw t("SET_ERROR",a.message),console.error(`获取Agent详情失败 (ID=${e}):`,a),a}finally{t("SET_LOADING",!1)}},async createMainAgent({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await S["a"].createMainAgent(e);return t("ADD_AGENT",a),a}catch(a){throw t("SET_ERROR",a.message),console.error("创建主Agent失败:",a),a}finally{t("SET_LOADING",!1)}},async cancelAgent({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{return await S["a"].cancelAgent(e),t("UPDATE_AGENT_STATUS",{agentId:e,status:"canceled"}),!0}catch(a){throw t("SET_ERROR",a.message),console.error(`取消Agent失败 (ID=${e}):`,a),a}finally{t("SET_LOADING",!1)}},async pollAgentStatus({dispatch:t}){try{await t("fetchAgents"),setTimeout(()=>{t("pollAgentStatus")},5e3)}catch(e){console.error("Agent状态轮询失败:",e),setTimeout(()=>{t("pollAgentStatus")},1e4)}},async removeAgent({commit:t},e){try{await S["a"].cancelAgent(e),t("REMOVE_AGENT",e)}catch(a){throw console.error(`移除Agent失败 (ID=${e}):`,a),a}}};var I={namespaced:!0,state:O,getters:L,mutations:w,actions:D};const N={templates:[],template:null,loading:!1,error:null},G={allTemplates:t=>t.templates,getTemplateById:t=>e=>t.templates.find(t=>t.id===e),templateTypes:t=>[...new Set(t.templates.map(t=>t.template_type))]},P={SET_TEMPLATES(t,e){t.templates=e},SET_TEMPLATE(t,e){t.template=e},ADD_TEMPLATE(t,e){t.templates.push(e)},UPDATE_TEMPLATE(t,e){const a=t.templates.findIndex(t=>t.id===e.id);-1!==a&&t.templates.splice(a,1,e)},DELETE_TEMPLATE(t,e){t.templates=t.templates.filter(t=>t.id!==e)},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e}},C={async fetchTemplates({commit:t},e={}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await S["c"].getTemplates(e);return t("SET_TEMPLATES",a),a}catch(a){throw t("SET_ERROR",a.message),console.error("获取模板列表失败:",a),a}finally{t("SET_LOADING",!1)}},async fetchTemplate({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await S["c"].getTemplate(e);return t("SET_TEMPLATE",a),a}catch(a){throw t("SET_ERROR",a.message),console.error(`获取模板失败 (ID=${e}):`,a),a}finally{t("SET_LOADING",!1)}},async createTemplate({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await S["c"].createTemplate(e);return t("ADD_TEMPLATE",a),a}catch(a){throw t("SET_ERROR",a.message),console.error("创建模板失败:",a),a}finally{t("SET_LOADING",!1)}},async updateTemplate({commit:t},{templateId:e,templateData:a}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const s=await S["c"].updateTemplate(e,a);return t("UPDATE_TEMPLATE",s),s}catch(s){throw t("SET_ERROR",s.message),console.error(`更新模板失败 (ID=${e}):`,s),s}finally{t("SET_LOADING",!1)}},async deleteTemplate({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{return await S["c"].deleteTemplate(e),t("DELETE_TEMPLATE",e),!0}catch(a){throw t("SET_ERROR",a.message),console.error(`删除模板失败 (ID=${e}):`,a),a}finally{t("SET_LOADING",!1)}}};var x={namespaced:!0,state:N,getters:G,mutations:P,actions:C};s["default"].use(A["a"]);var M=new A["a"].Store({state:{loading:!1,error:null},mutations:{SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e},CLEAR_ERROR(t){t.error=null}},actions:{setLoading({commit:t},e){t("SET_LOADING",e)},setError({commit:t},e){t("SET_ERROR",e)},clearError({commit:t}){t("CLEAR_ERROR")}},modules:{tasks:v,agents:I,templates:x}}),$=a("5f5b"),j=a("b1e0");a("f9e3"),a("2dd8");s["default"].use($["a"]),s["default"].use(j["a"]),s["default"].config.errorHandler=function(t,e,a){console.error("Vue错误:",t),console.error("错误信息:",a)},s["default"].config.productionTip=!1,new s["default"]({router:h,store:M,render:t=>t(u)}).$mount("#app")},7424:function(t,e,a){"use strict";a.d(e,"b",(function(){return o})),a.d(e,"a",(function(){return c})),a.d(e,"c",(function(){return i}));var s=a("bc3a"),n=a.n(s);const r=n.a.create({baseURL:"http://localhost:5050/api",timeout:1e4,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(t=>t,t=>Promise.reject(t)),r.interceptors.response.use(t=>{const e=t.data;return!1===e.success?Promise.reject(new Error(e.message||"操作失败")):e.data||e},t=>{let e="请求失败，请稍后再试";if(t.response){const{status:a,data:s}=t.response;switch(a){case 400:e=s.message||"请求参数错误";break;case 404:e="请求的资源不存在";break;case 500:e="服务器内部错误";break;default:e=`请求错误 (${a})`}}else t.request?e="无法连接到服务器，请检查网络":t.message&&(e=t.message);return console.error("API错误:",e),Promise.reject(new Error(e))});const o={getTasks:(t={})=>r.get("/tasks/",{params:t}),getTask:t=>r.get("/tasks/"+t),createTask:t=>r.post("/tasks/",t),updateTask:(t,e)=>r.put("/tasks/"+t,e),cancelTask:t=>r.post(`/tasks/${t}/cancel`),getTaskLog:(t,e={})=>r.get(`/tasks/${t}/log`,{params:e}),appendTaskLog:(t,e)=>r.post(`/tasks/${t}/log`,{content:e})},c={getAgents:(t={})=>r.get("/agents/",{params:t}),getAgent:t=>r.get("/agents/"+t),createMainAgent:t=>r.post("/agents/main",t),createSubAgent:t=>r.post("/agents/sub",t),cancelAgent:t=>r.post(`/agents/${t}/cancel`)},i={getTemplates:(t={})=>r.get("/templates/",{params:t}),getTemplate:t=>r.get("/templates/"+t),createTemplate:t=>r.post("/templates/",t),updateTemplate:(t,e)=>r.put("/templates/"+t,e),deleteTemplate:t=>r.delete("/templates/"+t)}},b140:function(t,e,a){"use strict";a("ff7b")},ff7b:function(t,e,a){}});
//# sourceMappingURL=app.275f728f.js.map