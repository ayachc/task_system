{"version":3,"sources":["webpack:///./src/views/Tasks/TaskNew.vue?18f8","webpack:///./src/views/Tasks/TaskNew.vue","webpack:///src/views/Tasks/TaskNew.vue","webpack:///./src/views/Tasks/TaskNew.vue?5428","webpack:///./src/views/Tasks/TaskNew.vue?6579"],"names":["render","_vm","this","_c","_self","staticClass","on","$event","preventDefault","submitTask","apply","arguments","_v","attrs","nameState","nameInvalidFeedback","model","value","task","name","callback","$$v","$set","expression","templateTypeState","templateTypeInvalidFeedback","templateOptions","handleTemplateChange","template_type","priority","_s","getPriorityText","dependsOnState","dependsOnInvalidFeedback","depends_on","cpuCoresState","cpuCoresInvalidFeedback","cpu_cores","_n","gpuCountState","gpuCountInvalidFeedback","gpu_count","gpuMemoryState","gpuMemoryOptions","gpu_memory","scriptContentState","scriptContentInvalidFeedback","script_content","error","clearError","_e","$router","push","loading","staticRenderFns","data","validated","text","computed","mapState","state","mapGetters","options","allTemplates","length","templateTypes","Set","map","t","forEach","type","trim","pattern","test","methods","mapActions","priorityMap","template","find","parseDependsOn","split","id","parseInt","filter","isNaN","$bvToast","toast","title","variant","solid","taskData","result","createTask","fetchTemplates","console","component"],"mappings":"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","file":"js/chunk-7aad115e.f8c2428d.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TaskNew.vue?vue&type=style&index=0&id=238a237d&prod&scoped=true&lang=css\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"task-new\"},[_c('b-form',{staticClass:\"mt-3\",on:{\"submit\":function($event){$event.preventDefault();return _vm.submitTask.apply(null, arguments)}}},[_c('div',{staticClass:\"card\"},[_c('div',{staticClass:\"card-header\"},[_c('h5',{staticClass:\"mb-0\"},[_vm._v(\"基本信息\")])]),_c('div',{staticClass:\"card-body\"},[_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col-md-6\"},[_c('b-form-group',{attrs:{\"label\":\"任务名称\",\"label-for\":\"task-name\",\"state\":_vm.nameState,\"invalid-feedback\":_vm.nameInvalidFeedback}},[_c('b-form-input',{attrs:{\"id\":\"task-name\",\"state\":_vm.nameState,\"required\":\"\",\"placeholder\":\"请输入任务名称\"},model:{value:(_vm.task.name),callback:function ($$v) {_vm.$set(_vm.task, \"name\", $$v)},expression:\"task.name\"}})],1)],1),_c('div',{staticClass:\"col-md-6\"},[_c('b-form-group',{attrs:{\"label\":\"模板类型\",\"label-for\":\"template-type\",\"state\":_vm.templateTypeState,\"invalid-feedback\":_vm.templateTypeInvalidFeedback}},[_c('b-form-select',{attrs:{\"id\":\"template-type\",\"options\":_vm.templateOptions,\"state\":_vm.templateTypeState,\"required\":\"\"},on:{\"change\":_vm.handleTemplateChange},model:{value:(_vm.task.template_type),callback:function ($$v) {_vm.$set(_vm.task, \"template_type\", $$v)},expression:\"task.template_type\"}})],1)],1),_c('div',{staticClass:\"col-md-6\"},[_c('b-form-group',{attrs:{\"label\":\"优先级\",\"label-for\":\"priority\"}},[_c('div',{staticClass:\"d-flex align-items-center\"},[_c('b-form-input',{staticClass:\"mr-3\",attrs:{\"id\":\"priority\",\"type\":\"range\",\"min\":\"1\",\"max\":\"5\",\"step\":\"1\"},model:{value:(_vm.task.priority),callback:function ($$v) {_vm.$set(_vm.task, \"priority\", $$v)},expression:\"task.priority\"}}),_c('span',{staticClass:\"priority-label\"},[_vm._v(_vm._s(_vm.getPriorityText(_vm.task.priority)))])],1)])],1),_c('div',{staticClass:\"col-md-6\"},[_c('b-form-group',{attrs:{\"label\":\"依赖任务 (可选)\",\"label-for\":\"depends-on\",\"description\":\"多个任务ID用逗号分隔\",\"state\":_vm.dependsOnState,\"invalid-feedback\":_vm.dependsOnInvalidFeedback}},[_c('b-form-input',{attrs:{\"id\":\"depends-on\",\"state\":_vm.dependsOnState,\"placeholder\":\"例如: 1,2,3\"},model:{value:(_vm.task.depends_on),callback:function ($$v) {_vm.$set(_vm.task, \"depends_on\", $$v)},expression:\"task.depends_on\"}})],1)],1)])])]),_c('div',{staticClass:\"card mt-3\"},[_c('div',{staticClass:\"card-header\"},[_c('h5',{staticClass:\"mb-0\"},[_vm._v(\"资源配置\")])]),_c('div',{staticClass:\"card-body\"},[_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col-md-4\"},[_c('b-form-group',{attrs:{\"label\":\"CPU核心数\",\"label-for\":\"cpu-cores\",\"state\":_vm.cpuCoresState,\"invalid-feedback\":_vm.cpuCoresInvalidFeedback}},[_c('b-form-input',{attrs:{\"id\":\"cpu-cores\",\"type\":\"number\",\"min\":\"1\",\"state\":_vm.cpuCoresState,\"placeholder\":\"默认: 1\"},model:{value:(_vm.task.cpu_cores),callback:function ($$v) {_vm.$set(_vm.task, \"cpu_cores\", _vm._n($$v))},expression:\"task.cpu_cores\"}})],1)],1),_c('div',{staticClass:\"col-md-4\"},[_c('b-form-group',{attrs:{\"label\":\"GPU数量\",\"label-for\":\"gpu-count\",\"state\":_vm.gpuCountState,\"invalid-feedback\":_vm.gpuCountInvalidFeedback}},[_c('b-form-input',{attrs:{\"id\":\"gpu-count\",\"type\":\"number\",\"min\":\"0\",\"state\":_vm.gpuCountState,\"placeholder\":\"默认: 0\"},model:{value:(_vm.task.gpu_count),callback:function ($$v) {_vm.$set(_vm.task, \"gpu_count\", _vm._n($$v))},expression:\"task.gpu_count\"}})],1)],1),_c('div',{staticClass:\"col-md-4\"},[_c('b-form-group',{attrs:{\"label\":\"GPU显存要求 (每卡GB)\",\"label-for\":\"gpu-memory\",\"state\":_vm.gpuMemoryState}},[_c('b-form-select',{attrs:{\"id\":\"gpu-memory\",\"options\":_vm.gpuMemoryOptions,\"state\":_vm.gpuMemoryState},model:{value:(_vm.task.gpu_memory),callback:function ($$v) {_vm.$set(_vm.task, \"gpu_memory\", _vm._n($$v))},expression:\"task.gpu_memory\"}})],1)],1)])])]),_c('div',{staticClass:\"card mt-3\"},[_c('div',{staticClass:\"card-header\"},[_c('h5',{staticClass:\"mb-0\"},[_vm._v(\"脚本内容\")])]),_c('div',{staticClass:\"card-body\"},[_c('b-form-group',{attrs:{\"label-for\":\"script-content\",\"state\":_vm.scriptContentState,\"invalid-feedback\":_vm.scriptContentInvalidFeedback}},[_c('b-form-textarea',{staticClass:\"code-textarea\",attrs:{\"id\":\"script-content\",\"rows\":\"12\",\"state\":_vm.scriptContentState,\"required\":\"\",\"placeholder\":\"请输入脚本内容\",\"no-resize\":\"\"},model:{value:(_vm.task.script_content),callback:function ($$v) {_vm.$set(_vm.task, \"script_content\", $$v)},expression:\"task.script_content\"}})],1)],1)]),(_vm.error)?_c('b-alert',{staticClass:\"mt-3\",attrs:{\"variant\":\"danger\",\"dismissible\":\"\",\"show\":\"\"},on:{\"dismissed\":_vm.clearError}},[_vm._v(\" \"+_vm._s(_vm.error)+\" \")]):_vm._e(),_c('div',{staticClass:\"mt-4 d-flex justify-content-between\"},[_c('b-button',{attrs:{\"variant\":\"secondary\"},on:{\"click\":function($event){return _vm.$router.push('/tasks')}}},[_vm._v(\"取消\")]),_c('b-button',{attrs:{\"type\":\"submit\",\"variant\":\"primary\",\"disabled\":_vm.loading}},[(_vm.loading)?_c('b-spinner',{staticClass:\"mr-1\",attrs:{\"small\":\"\"}}):_vm._e(),_vm._v(\" 创建任务 \")],1)],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"task-new\">\n    <b-form @submit.prevent=\"submitTask\" class=\"mt-3\">\n      <div class=\"card\">\n        <div class=\"card-header\">\n          <h5 class=\"mb-0\">基本信息</h5>\n        </div>\n        <div class=\"card-body\">\n          <!-- 基本信息 -->\n          <div class=\"row\">\n            <!-- 任务名称 -->\n            <div class=\"col-md-6\">\n              <b-form-group\n                label=\"任务名称\"\n                label-for=\"task-name\"\n                :state=\"nameState\"\n                :invalid-feedback=\"nameInvalidFeedback\"\n              >\n                <b-form-input\n                  id=\"task-name\"\n                  v-model=\"task.name\"\n                  :state=\"nameState\"\n                  required\n                  placeholder=\"请输入任务名称\"\n                ></b-form-input>\n              </b-form-group>\n            </div>\n            \n            <!-- 模板类型 -->\n            <div class=\"col-md-6\">\n              <b-form-group\n                label=\"模板类型\"\n                label-for=\"template-type\"\n                :state=\"templateTypeState\"\n                :invalid-feedback=\"templateTypeInvalidFeedback\"\n              >\n                <b-form-select\n                  id=\"template-type\"\n                  v-model=\"task.template_type\"\n                  :options=\"templateOptions\"\n                  :state=\"templateTypeState\"\n                  required\n                  @change=\"handleTemplateChange\"\n                ></b-form-select>\n              </b-form-group>\n            </div>\n            \n            <!-- 优先级 -->\n            <div class=\"col-md-6\">\n              <b-form-group label=\"优先级\" label-for=\"priority\">\n                <div class=\"d-flex align-items-center\">\n                  <b-form-input\n                    id=\"priority\"\n                    v-model=\"task.priority\"\n                    type=\"range\"\n                    min=\"1\"\n                    max=\"5\"\n                    step=\"1\"\n                    class=\"mr-3\"\n                  ></b-form-input>\n                  <span class=\"priority-label\">{{ getPriorityText(task.priority) }}</span>\n                </div>\n              </b-form-group>\n            </div>\n            \n            <!-- 依赖任务 -->\n            <div class=\"col-md-6\">\n              <b-form-group\n                label=\"依赖任务 (可选)\"\n                label-for=\"depends-on\"\n                description=\"多个任务ID用逗号分隔\"\n                :state=\"dependsOnState\"\n                :invalid-feedback=\"dependsOnInvalidFeedback\"\n              >\n                <b-form-input\n                  id=\"depends-on\"\n                  v-model=\"task.depends_on\"\n                  :state=\"dependsOnState\"\n                  placeholder=\"例如: 1,2,3\"\n                ></b-form-input>\n              </b-form-group>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- 资源配置 -->\n      <div class=\"card mt-3\">\n        <div class=\"card-header\">\n          <h5 class=\"mb-0\">资源配置</h5>\n        </div>\n        <div class=\"card-body\">\n          <div class=\"row\">\n            <!-- CPU核心数 -->\n            <div class=\"col-md-4\">\n              <b-form-group\n                label=\"CPU核心数\"\n                label-for=\"cpu-cores\"\n                :state=\"cpuCoresState\"\n                :invalid-feedback=\"cpuCoresInvalidFeedback\"\n              >\n                <b-form-input\n                  id=\"cpu-cores\"\n                  v-model.number=\"task.cpu_cores\"\n                  type=\"number\"\n                  min=\"1\"\n                  :state=\"cpuCoresState\"\n                  placeholder=\"默认: 1\"\n                ></b-form-input>\n              </b-form-group>\n            </div>\n            \n            <!-- GPU数量 -->\n            <div class=\"col-md-4\">\n              <b-form-group\n                label=\"GPU数量\"\n                label-for=\"gpu-count\"\n                :state=\"gpuCountState\"\n                :invalid-feedback=\"gpuCountInvalidFeedback\"\n              >\n                <b-form-input\n                  id=\"gpu-count\"\n                  v-model.number=\"task.gpu_count\"\n                  type=\"number\"\n                  min=\"0\"\n                  :state=\"gpuCountState\"\n                  placeholder=\"默认: 0\"\n                ></b-form-input>\n              </b-form-group>\n            </div>\n            \n            <!-- GPU显存 -->\n            <div class=\"col-md-4\">\n              <b-form-group\n                label=\"GPU显存要求 (每卡GB)\"\n                label-for=\"gpu-memory\"\n                :state=\"gpuMemoryState\"\n              >\n                <b-form-select\n                  id=\"gpu-memory\"\n                  v-model.number=\"task.gpu_memory\"\n                  :options=\"gpuMemoryOptions\"\n                  :state=\"gpuMemoryState\"\n                ></b-form-select>\n              </b-form-group>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- 脚本内容 -->\n      <div class=\"card mt-3\">\n        <div class=\"card-header\">\n          <h5 class=\"mb-0\">脚本内容</h5>\n        </div>\n        <div class=\"card-body\">\n          <b-form-group\n            label-for=\"script-content\"\n            :state=\"scriptContentState\"\n            :invalid-feedback=\"scriptContentInvalidFeedback\"\n          >\n            <b-form-textarea\n              id=\"script-content\"\n              v-model=\"task.script_content\"\n              rows=\"12\"\n              :state=\"scriptContentState\"\n              required\n              placeholder=\"请输入脚本内容\"\n              no-resize\n              class=\"code-textarea\"\n            ></b-form-textarea>\n          </b-form-group>\n        </div>\n      </div>\n      \n      <!-- 错误提示 -->\n      <b-alert \n        v-if=\"error\" \n        variant=\"danger\" \n        dismissible \n        show \n        class=\"mt-3\"\n        @dismissed=\"clearError\"\n      >\n        {{ error }}\n      </b-alert>\n      \n      <!-- 提交按钮 -->\n      <div class=\"mt-4 d-flex justify-content-between\">\n        <b-button variant=\"secondary\" @click=\"$router.push('/tasks')\">取消</b-button>\n        <b-button type=\"submit\" variant=\"primary\" :disabled=\"loading\">\n          <b-spinner small v-if=\"loading\" class=\"mr-1\"></b-spinner>\n          创建任务\n        </b-button>\n      </div>\n    </b-form>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters, mapActions } from 'vuex'\n\nexport default {\n  name: 'TaskNew',\n  \n  data() {\n    return {\n      task: {\n        name: '',\n        template_type: '',\n        script_content: '',\n        priority: 3,\n        depends_on: '',\n        cpu_cores: 1,\n        gpu_count: 0,\n        gpu_memory: 0\n      },\n      validated: false,\n      gpuMemoryOptions: [\n        { value: 0, text: '不使用GPU' },\n        { value: 8, text: '8 GB' },\n        { value: 12, text: '12 GB' },\n        { value: 16, text: '16 GB' },\n        { value: 24, text: '24 GB' },\n        { value: 32, text: '32 GB' },\n        { value: 48, text: '48 GB' },\n        { value: 80, text: '80 GB' }\n      ]\n    }\n  },\n  \n  computed: {\n    ...mapState({\n      loading: state => state.loading,\n      error: state => state.error\n    }),\n    ...mapGetters('templates', ['allTemplates']),\n    \n    // 模板选项\n    templateOptions() {\n      const options = [\n        { value: '', text: '请选择模板类型' },\n        { value: 'custom', text: '自定义脚本' }\n      ]\n      \n      // 添加可用的模板类型\n      if (this.allTemplates && this.allTemplates.length > 0) {\n        const templateTypes = [...new Set(this.allTemplates.map(t => t.template_type))]\n        \n        templateTypes.forEach(type => {\n          if (type) {\n            options.push({\n              value: type,\n              text: type\n            })\n          }\n        })\n      }\n      \n      return options\n    },\n    \n    // 表单验证状态\n    nameState() {\n      if (!this.validated) return null\n      return this.task.name.trim().length > 0\n    },\n    \n    templateTypeState() {\n      if (!this.validated) return null\n      return this.task.template_type.trim().length > 0\n    },\n    \n    scriptContentState() {\n      if (!this.validated) return null\n      return this.task.script_content.trim().length > 0\n    },\n    \n    cpuCoresState() {\n      if (!this.validated) return null\n      return this.task.cpu_cores > 0\n    },\n    \n    gpuCountState() {\n      if (!this.validated) return null\n      return this.task.gpu_count >= 0\n    },\n    \n    gpuMemoryState() {\n      if (!this.validated) return null\n      return true // 永远有效，因为是下拉选择\n    },\n    \n    dependsOnState() {\n      if (!this.validated || !this.task.depends_on) return null\n      const pattern = /^(\\d+)(,\\d+)*$/\n      return pattern.test(this.task.depends_on)\n    },\n    \n    // 错误反馈消息\n    nameInvalidFeedback() {\n      return '请输入任务名称'\n    },\n    \n    templateTypeInvalidFeedback() {\n      return '请选择模板类型'\n    },\n    \n    scriptContentInvalidFeedback() {\n      return '请输入脚本内容'\n    },\n    \n    cpuCoresInvalidFeedback() {\n      return 'CPU核心数必须大于0'\n    },\n    \n    gpuCountInvalidFeedback() {\n      return 'GPU数量不能为负数'\n    },\n    \n    dependsOnInvalidFeedback() {\n      return '请输入有效的任务ID，多个ID用逗号分隔'\n    }\n  },\n  \n  methods: {\n    ...mapActions('tasks', ['createTask']),\n    ...mapActions('templates', ['fetchTemplates']),\n    ...mapActions(['clearError']),\n    \n    // 获取优先级文本\n    getPriorityText(priority) {\n      const priorityMap = {\n        1: '最高',\n        2: '高',\n        3: '中',\n        4: '低',\n        5: '最低'\n      }\n      return priorityMap[priority] || priority\n    },\n    \n    // 处理模板变更\n    handleTemplateChange() {\n      if (this.task.template_type && this.task.template_type !== 'custom') {\n        // 查找对应的模板内容\n        const template = this.allTemplates.find(t => t.template_type === this.task.template_type)\n        if (template) {\n          this.task.script_content = template.script_content || ''\n        }\n      } else if (this.task.template_type === 'custom') {\n        // 自定义脚本，清空内容\n        this.task.script_content = ''\n      }\n    },\n    \n    // 解析依赖任务ID\n    parseDependsOn() {\n      if (!this.task.depends_on) {\n        return []\n      }\n      \n      return this.task.depends_on.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id))\n    },\n    \n    // 提交任务\n    async submitTask() {\n      this.validated = true\n      \n      // 验证表单\n      if (\n        !this.nameState ||\n        !this.templateTypeState ||\n        !this.scriptContentState ||\n        !this.cpuCoresState ||\n        !this.gpuCountState ||\n        (this.task.depends_on && !this.dependsOnState)\n      ) {\n        this.$bvToast.toast('请修正表单中的错误', {\n          title: '验证失败',\n          variant: 'danger',\n          solid: true\n        })\n        return\n      }\n      \n      // 准备任务数据\n      const taskData = {\n        name: this.task.name,\n        template_type: this.task.template_type,\n        script_content: this.task.script_content,\n        priority: parseInt(this.task.priority),\n        cpu_cores: parseInt(this.task.cpu_cores),\n        gpu_count: parseInt(this.task.gpu_count),\n        gpu_memory: parseInt(this.task.gpu_memory),\n        depends_on: this.parseDependsOn()\n      }\n      \n      try {\n        // 提交任务\n        const result = await this.createTask(taskData)\n        \n        this.$bvToast.toast('任务创建成功', {\n          title: '成功',\n          variant: 'success',\n          solid: true\n        })\n        \n        // 跳转到任务详情页\n        this.$router.push(`/tasks/${result.id}`)\n      } catch (error) {\n        // 错误已在store中处理\n      }\n    }\n  },\n  \n  async created() {\n    try {\n      // 获取模板列表\n      await this.fetchTemplates()\n    } catch (error) {\n      console.error('获取模板数据失败:', error)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.priority-label {\n  width: 2.5rem;\n  text-align: center;\n}\n\n.code-textarea {\n  font-family: 'Courier New', Courier, monospace;\n  font-size: 0.85rem;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TaskNew.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TaskNew.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./TaskNew.vue?vue&type=template&id=238a237d&scoped=true\"\nimport script from \"./TaskNew.vue?vue&type=script&lang=js\"\nexport * from \"./TaskNew.vue?vue&type=script&lang=js\"\nimport style0 from \"./TaskNew.vue?vue&type=style&index=0&id=238a237d&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"238a237d\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}