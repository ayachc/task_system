(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44a4bfb0"],{"41de":function(t,s,a){"use strict";a("e8c7")},b480:function(t,s,a){"use strict";a.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"task-detail"},[t.loading?s("div",{staticClass:"text-center my-5"},[s("b-spinner",{attrs:{variant:"primary"}}),s("p",{staticClass:"mt-2"},[t._v("加载任务详情...")])],1):t.task?s("div",["failed"===t.task.status?s("b-alert",{staticClass:"mb-4",attrs:{show:"",variant:"danger"}},[s("h5",[s("i",{staticClass:"bi bi-exclamation-triangle-fill mr-2"}),t._v("任务执行失败")]),t._v(" 请查看日志了解详细错误信息 ")]):t._e(),s("div",{staticClass:"card mb-4"},[s("div",{staticClass:"card-header d-flex justify-content-between align-items-center"},[s("h5",{staticClass:"mb-0"},[t._v("任务信息")]),s("b-badge",{class:"status-"+t.task.status},[t._v(t._s(t.getStatusText(t.task.status)))])],1),s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-6"},[s("dl",{staticClass:"row mb-0"},[s("dt",{staticClass:"col-sm-4"},[t._v("ID")]),s("dd",{staticClass:"col-sm-8"},[t._v(t._s(t.task.id))]),s("dt",{staticClass:"col-sm-4"},[t._v("名称")]),s("dd",{staticClass:"col-sm-8"},[t._v(t._s(t.task.name))]),s("dt",{staticClass:"col-sm-4"},[t._v("模板类型")]),s("dd",{staticClass:"col-sm-8"},[t._v(t._s(t.task.template_type))]),s("dt",{staticClass:"col-sm-4"},[t._v("优先级")]),s("dd",{staticClass:"col-sm-8"},[s("b-badge",{attrs:{variant:"secondary"}},[t._v(t._s(t.getPriorityText(t.task.priority)))])],1),s("dt",{staticClass:"col-sm-4"},[t._v("状态")]),s("dd",{staticClass:"col-sm-8"},[s("b-badge",{class:"status-"+t.task.status},[t._v(" "+t._s(t.getStatusText(t.task.status))+" ")])],1)])]),s("div",{staticClass:"col-md-6"},[s("dl",{staticClass:"row mb-0"},[s("dt",{staticClass:"col-sm-4"},[t._v("创建时间")]),s("dd",{staticClass:"col-sm-8"},[t._v(t._s(t.formatDate(t.task.created_time)))]),s("dt",{staticClass:"col-sm-4"},[t._v("开始时间")]),s("dd",{staticClass:"col-sm-8"},[t._v(t._s(t.task.start_time?t.formatDate(t.task.start_time):"尚未开始"))]),s("dt",{staticClass:"col-sm-4"},[t._v("结束时间")]),s("dd",{staticClass:"col-sm-8"},[t._v(t._s(t.task.end_time?t.formatDate(t.task.end_time):"尚未结束"))]),s("dt",{staticClass:"col-sm-4"},[t._v("执行耗时")]),s("dd",{staticClass:"col-sm-8"},[t._v(t._s(t.task.execution_time?t.formatDuration(t.task.execution_time):"尚未完成"))]),s("dt",{staticClass:"col-sm-4"},[t._v("执行Agent")]),s("dd",{staticClass:"col-sm-8"},[t._v(t._s(t.task.agent_id||"尚未分配"))])])])])])]),s("div",{staticClass:"card mb-4"},[t._m(0),s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"d-flex align-items-center"},[t._m(1),s("div",[s("div",{staticClass:"text-muted small"},[t._v("CPU核心数")]),s("div",{staticClass:"font-weight-bold"},[t._v(t._s(t.task.cpu_cores||1))])])])]),s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"d-flex align-items-center"},[t._m(2),s("div",[s("div",{staticClass:"text-muted small"},[t._v("GPU数量")]),s("div",{staticClass:"font-weight-bold"},[t._v(t._s(t.task.gpu_count||0))])])])]),s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"d-flex align-items-center"},[t._m(3),s("div",[s("div",{staticClass:"text-muted small"},[t._v("GPU显存(GB/卡)")]),s("div",{staticClass:"font-weight-bold"},[t._v(t._s(t.task.gpu_memory||0))])])])])])])]),t.task.depends_on&&t.task.depends_on.length>0?s("div",{staticClass:"card mb-4"},[t._m(4),s("div",{staticClass:"card-body"},[s("div",{staticClass:"list-group"},t._l(t.task.depends_on,(function(a){return s("div",{key:a,staticClass:"list-group-item list-group-item-action d-flex justify-content-between align-items-center"},[s("span",[t._v("任务 #"+t._s(a))]),s("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(s){return t.viewTaskDetail(a)}}},[t._v("查看")])],1)})),0)])]):t._e(),s("div",{staticClass:"card mb-4"},[s("div",{staticClass:"card-header d-flex justify-content-between align-items-center"},[s("h5",{staticClass:"mb-0"},[t._v("脚本内容")]),s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.script-collapse",modifiers:{"script-collapse":!0}}],attrs:{size:"sm",variant:"outline-secondary"}},[s("i",{staticClass:"bi bi-code-slash mr-1"}),t._v(" 显示/隐藏 ")])],1),s("b-collapse",{attrs:{id:"script-collapse",visible:""}},[s("div",{staticClass:"card-body p-0"},[s("pre",{staticClass:"script-content"},[t._v(t._s(t.task.script_content))])])])],1),s("div",{staticClass:"card"},[s("div",{staticClass:"card-header d-flex justify-content-between align-items-center"},[s("h5",{staticClass:"mb-0"},[t._v("执行日志")]),s("div",[s("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"outline-secondary"},on:{click:t.refreshLog}},[s("i",{staticClass:"bi bi-arrow-clockwise mr-1"}),t._v(" 刷新 ")]),s("b-form-checkbox",{staticClass:"d-inline-block ml-2",attrs:{switch:""},model:{value:t.autoRefresh,callback:function(s){t.autoRefresh=s},expression:"autoRefresh"}},[t._v(" 自动刷新 ")])],1)]),s("div",{staticClass:"card-body p-0"},[s("div",{ref:"logContainer",staticClass:"log-container"},[t.taskLog?s("pre",{staticClass:"log-content m-0 p-3"},[t._v(t._s(t.taskLog))]):s("div",{staticClass:"text-center py-4 text-muted"},[s("p",[t._v("暂无日志信息")])])])])]),s("div",{staticClass:"mt-4 d-flex justify-content-between"},[s("b-button",{attrs:{variant:"secondary"},on:{click:function(s){return t.$router.push("/tasks")}}},[t._v("返回任务列表")]),["waiting","blocked","running"].includes(t.task.status)?s("b-button",{attrs:{variant:"danger"},on:{click:t.confirmCancel}},[t._v(" 取消任务 ")]):t._e()],1),s("b-modal",{attrs:{id:"cancel-modal",title:"取消任务","ok-title":"确认取消","ok-variant":"danger","cancel-title":"返回"},on:{ok:t.cancelTask}},[s("p",[t._v("您确认要取消任务 "),s("strong",[t._v(t._s(t.task?t.task.name:""))]),t._v(" 吗？")]),s("p",{staticClass:"text-danger"},[t._v("此操作不可撤销！")])])],1):s("div",{staticClass:"alert alert-danger"},[t._v(" 任务不存在或已被删除 ")])])},e=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"card-header"},[s("h5",{staticClass:"mb-0"},[t._v("资源需求")])])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"mr-2 resource-icon"},[s("i",{staticClass:"bi bi-cpu"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"mr-2 resource-icon"},[s("i",{staticClass:"bi bi-gpu-card"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"mr-2 resource-icon"},[s("i",{staticClass:"bi bi-memory"})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"card-header"},[s("h5",{staticClass:"mb-0"},[t._v("依赖任务")])])}],c=a("2f62"),r=a("c1df"),l=a.n(r),n={name:"TaskDetail",props:{id:{type:[String,Number],required:!0}},data(){return{taskLog:"",autoRefresh:!0,refreshInterval:null}},computed:{...Object(c["d"])({task:t=>t.tasks.task,loading:t=>t.loading,error:t=>t.error})},methods:{...Object(c["b"])("tasks",["fetchTask","fetchTaskLog","cancelTask"]),...Object(c["b"])(["clearError"]),formatDate(t){return t?l()(t).format("YYYY-MM-DD HH:mm:ss"):""},formatDuration(t){if(!t)return"0秒";const s=Math.floor(t/3600),a=Math.floor(t%3600/60),i=t%60;let e="";return s>0&&(e+=s+"小时 "),a>0&&(e+=a+"分钟 "),(i>0||!e)&&(e+=i+"秒"),e},getStatusText(t){const s={waiting:"等待中",blocked:"被阻塞",running:"运行中",completed:"已完成",failed:"失败",canceled:"已取消"};return s[t]||t},getPriorityText(t){const s={1:"最高",2:"高",3:"中",4:"低",5:"最低"};return s[t]||t},viewTaskDetail(t){this.$router.push("/tasks/"+t)},confirmCancel(){this.$bvModal.show("cancel-modal")},async refreshLog(){try{const t=await this.fetchTaskLog({taskId:this.id});this.taskLog=t.content||"",this.$nextTick(()=>{this.$refs.logContainer&&(this.$refs.logContainer.scrollTop=this.$refs.logContainer.scrollHeight)})}catch(t){console.error("获取任务日志失败:",t)}},async updateTaskData(){await this.fetchTask(this.id),await this.refreshLog()},async cancelTask(){try{await this.cancelTask(this.id),this.$bvToast.toast("任务已成功取消",{title:"操作成功",variant:"success",solid:!0}),await this.updateTaskData()}catch(t){}},startAutoRefresh(){this.stopAutoRefresh(),this.autoRefresh&&this.task&&["running","waiting","blocked"].includes(this.task.status)&&(this.refreshInterval=setInterval(()=>{this.updateTaskData()},5e3))},stopAutoRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}},async created(){await this.updateTaskData(),this.startAutoRefresh()},beforeDestroy(){this.stopAutoRefresh()},watch:{id:{handler:"updateTaskData",immediate:!0},autoRefresh(t){t?this.startAutoRefresh():this.stopAutoRefresh()},"task.status"(t){["running","waiting","blocked"].includes(t)||(this.autoRefresh=!1)}}},o=n,d=(a("41de"),a("2877")),v=Object(d["a"])(o,i,e,!1,null,"49b9180f",null);s["default"]=v.exports},e8c7:function(t,s,a){}}]);
//# sourceMappingURL=chunk-44a4bfb0.6be92c09.js.map