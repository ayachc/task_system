(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d8154e58"],{"1dc9":function(t,e,a){"use strict";a("ff4c")},f0b3:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"task-list"},[e("div",{staticClass:"card mb-4"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("筛选条件")]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-3"},[e("b-form-group",{attrs:{label:"状态"}},[e("b-form-select",{attrs:{options:t.statusOptions},on:{change:t.applyFilters},model:{value:t.filterStatus,callback:function(e){t.filterStatus=e},expression:"filterStatus"}})],1)],1),e("div",{staticClass:"col-md-3"},[e("b-form-group",{attrs:{label:"模板类型"}},[e("b-form-select",{attrs:{options:t.templateTypeOptions},on:{change:t.applyFilters},model:{value:t.filterTemplateType,callback:function(e){t.filterTemplateType=e},expression:"filterTemplateType"}})],1)],1),e("div",{staticClass:"col-md-4"},[e("b-form-group",{attrs:{label:"名称关键词"}},[e("b-form-input",{attrs:{placeholder:"输入任务名称关键词"},on:{input:t.debounceSearch},model:{value:t.filterName,callback:function(e){t.filterName=e},expression:"filterName"}})],1)],1),e("div",{staticClass:"col-md-2 d-flex align-items-end"},[e("b-button",{staticClass:"w-100",attrs:{variant:"outline-secondary",size:"sm"},on:{click:t.clearFilters}},[e("i",{staticClass:"bi bi-x-circle mr-1"}),t._v("清空筛选 ")])],1)])])]),e("div",{staticClass:"card"},[e("div",{staticClass:"card-body p-0"},[e("b-table",{staticClass:"mb-0",attrs:{striped:"",hover:"",items:t.tasks,fields:t.fields,busy:t.loading,"show-empty":"","empty-text":"没有找到任务，请调整筛选条件",responsive:""},scopedSlots:t._u([{key:"cell(status)",fn:function(a){return[e("b-badge",{class:"status-"+a.value},[t._v(t._s(t.getStatusText(a.value)))])]}},{key:"cell(priority)",fn:function(a){return[e("b-badge",{attrs:{variant:"secondary"}},[t._v(t._s(t.getPriorityText(a.value)))])]}},{key:"cell(created_time)",fn:function(e){return[t._v(" "+t._s(t.formatDate(e.value))+" ")]}},{key:"cell(actions)",fn:function(a){return[e("b-button-group",{attrs:{size:"sm"}},[e("b-button",{attrs:{variant:"outline-primary"},on:{click:function(e){return t.viewTaskDetail(a.item.id)}}},[e("i",{staticClass:"bi bi-eye"})]),e("b-button",{attrs:{variant:"outline-danger",disabled:!["waiting","blocked","running"].includes(a.item.status)},on:{click:function(e){return t.confirmCancel(a.item)}}},[e("i",{staticClass:"bi bi-x-circle"})])],1)]}},{key:"table-busy",fn:function(){return[e("div",{staticClass:"text-center my-2"},[e("b-spinner",{staticClass:"align-middle"}),e("strong",[t._v(" 加载中...")])],1)]},proxy:!0}])})],1),e("div",{staticClass:"card-footer d-flex justify-content-between align-items-center"},[e("small",{staticClass:"text-muted"},[t._v("共 "+t._s(t.pagination.total)+" 条记录")]),e("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.pagination.total,"per-page":t.pagination.perPage,limit:5,align:"right",size:"sm"},on:{change:t.changePage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)]),e("b-modal",{attrs:{id:"cancel-modal",title:"取消任务","ok-title":"确认取消","ok-variant":"danger","cancel-title":"返回"},on:{ok:t.doCancelTask}},[e("p",[t._v("您确认要取消任务 "),e("strong",[t._v(t._s(t.selectedTask?t.selectedTask.name:""))]),t._v(" 吗？")]),e("p",{staticClass:"text-danger"},[t._v("此操作不可撤销！已取消的任务将不会被执行。")])]),t.error?e("b-alert",{staticClass:"mt-3",attrs:{variant:"danger",dismissible:"",show:""},on:{dismissed:t.clearError}},[t._v(" "+t._s(t.error)+" ")]):t._e()],1)},i=[],l=a("2f62"),r=a("c1df"),n=a.n(r),c={name:"TaskList",data(){return{fields:[{key:"id",label:"ID",sortable:!0},{key:"name",label:"任务名称",sortable:!0},{key:"template_type",label:"模板类型",sortable:!0},{key:"priority",label:"优先级",sortable:!0},{key:"status",label:"状态",sortable:!0},{key:"created_time",label:"创建时间",sortable:!0},{key:"actions",label:"操作"}],selectedTask:null,currentPage:1,debounceTimer:null,filterStatus:"",filterName:"",filterTemplateType:"",statusOptions:[{value:"",text:"全部状态"},{value:"waiting",text:"等待中"},{value:"blocked",text:"被阻塞"},{value:"running",text:"运行中"},{value:"completed",text:"已完成"},{value:"failed",text:"失败"},{value:"canceled",text:"已取消"}],templateTypeOptions:[{value:"",text:"全部类型"}]}},computed:{...Object(l["d"])({tasks:t=>t.tasks.tasks,pagination:t=>t.tasks.pagination,loading:t=>t.loading,error:t=>t.error}),...Object(l["c"])("templates",["templateTypes"])},methods:{...Object(l["b"])("tasks",["fetchTasks","setPage","setFilters","cancelTask"]),...Object(l["b"])("templates",["fetchTemplates"]),...Object(l["b"])(["clearError"]),formatDate(t){return n()(t).format("YYYY-MM-DD HH:mm:ss")},getStatusText(t){const e={waiting:"等待中",blocked:"被阻塞",running:"运行中",completed:"已完成",failed:"失败",canceled:"已取消"};return e[t]||t},getPriorityText(t){const e={1:"最高",2:"高",3:"中",4:"低",5:"最低"};return e[t]||t},viewTaskDetail(t){this.$router.push("/tasks/"+t)},confirmCancel(t){this.selectedTask=t,this.$bvModal.show("cancel-modal")},async doCancelTask(){if(this.selectedTask)try{await this.cancelTask(this.selectedTask.id),this.$bvToast.toast("任务已成功取消",{title:"操作成功",variant:"success",solid:!0})}catch(t){}},changePage(t){this.currentPage=t,this.setPage(t)},applyFilters(){this.setFilters({status:this.filterStatus,name:this.filterName,template_type:this.filterTemplateType})},debounceSearch(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.applyFilters()},500)},clearFilters(){this.filterStatus="",this.filterName="",this.filterTemplateType="",this.applyFilters()},initTemplateTypeOptions(){this.templateTypes&&this.templateTypes.length>0&&(this.templateTypeOptions=[{value:"",text:"全部类型"},...this.templateTypes.map(t=>({value:t,text:t}))])}},async created(){try{await this.fetchTemplates(),this.initTemplateTypeOptions(),this.currentPage=this.pagination.page,await this.fetchTasks()}catch(t){console.error("初始化任务列表失败:",t)}},watch:{templateTypes:{handler:"initTemplateTypeOptions",immediate:!0}}},o=c,p=(a("1dc9"),a("2877")),u=Object(p["a"])(o,s,i,!1,null,"627e1461",null);e["default"]=u.exports},ff4c:function(t,e,a){}}]);
//# sourceMappingURL=chunk-d8154e58.f67d2c62.js.map